# 包

## 包的来源

不同于 Node. js中的内置模块与自定义模块,包是由第三方个人或团队开发出来的,免费供所有人使用

注意: Node js中的包都是免费且开源的,不需要付费即可免费下载使用。

## 为什么需要包

由于 Node js的内置模块仅提供了一些底层的APl,导致在基于内置模块进行项目开发的时,效率很低

包是基于内置模块封装出来的,提供了更高级、更方便的APl,极大的提高了开发效率。

包和内置模块之间的关系,类似于 jquery和浏览器内置AP之间的关系

## 从哪里下载包

国外有一家公司,叫做npm,Inc,这家公司旗下有一个非常著名的网站: https//www.npmjs.com,它是全球最大的包共享平台,你可以从这个网站上搜索到任何你需要的包,只要你有足够的耐心!

到目前位置,全球约1100多万的开发人员,通过这个包共享平台,开发并共享了超过120多万个包供我们使用

npm,Inc.公司提供了一个地址为https://registry.npmjs.org/的服务器,来对外共享所有的包,我们可以从这个服务器上下载自己所需要的包

## 如何下包

npm,Inc.公司提供了—个包管理工具,我们可以使用这个包管理工具,从https://registry.npmjs.org/服务器把需要的包下载到本地使用。

这个包管理工具的名字叫做node Package Manager(简称npm包管理工具),这个包管理工具随着 Node js的安装包一起被安装到了用户的电脑上。

大家可以在终端中执行npm -v命令,来查看自己电脑上所安装的npm包管理工具的版本号

## npm初体验

### 格式化时间

#### 格式化时间的传统做法

```javascript
const Time = require("./传统时间");
const dt = new Date();
const newDt = Time.date(dt)
console.log(newDt);
```

```javascript
function date(dtStr) {
    const a = new Date(dtStr);

    const b = a.getFullYear();
    const c = Zer(a.getMonth() + 1);
    const d = Zer(a.getDate());

    const bb = Zer(a.getHours());
    const cc = Zer(a.getMinutes());
    const dd = Zer(a.getSeconds());

    return `${b}-${c}-${d} ${bb}:${cc}:${dd}`
}

//定义补零的函数
function Zer(n) {
    return n > 9 ? n : '0' + n
}

module.exports = {
    date
}
```

#### 格式化时间的高级做法

使用npm包管理工具,在项目中安装格式化时间的包 moment

使用 require()导入格式化时间的包

参考 moment的官方AP文档对时间进行格式化

```javascript
const moment = require("moment");
const dt = moment().format('YYYY-MM-DD HH:mm:ss');
console.log(dt)//2022-01-13 23:03:07
```

如果想在项目中安装指定名称的包,需要运行如下的命令:

```node
npm
install
moment
```

上述的装包命令,可以简写成如下格式:

```node
npm
imoment
```

### 初次装包后多了哪些文件

初次装包完成后,在项目文件夹下多一个叫做 node modules的文件夹和 package- lock json的配置文件。

node modules文件夹用来存放所有已安装到项目中的包。 require0导入第三方包时,就是从这个目录中查找并加载包。

package-lock json配置文件用来记录 node modules目录下的每一个包的下载信息,例如包的名字、版本号、下载地址等。

package.json

```json
{
  "name": "npm",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.21",
    "moment": "^2.29.1"
  }
}
```

package-lock.json

```json
{
  "name": "npm",
  "version": "1.0.0",
  "lockfileVersion": 2,
  "requires": true,
  "packages": {
    "": {
      "name": "npm",
      "version": "1.0.0",
      "dependencies": {
        "lodash": "^4.17.21",
        "moment": "^2.29.1"
      }
    },
    "node_modules/lodash": {
      "version": "4.17.21",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz",
      "integrity": "sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg=="
    },
    "node_modules/moment": {
      "version": "2.29.1",
      "resolved": "https://registry.npmjs.org/moment/-/moment-2.29.1.tgz",
      "integrity": "sha512-kHmoybcPV8Sqy59DwNDY3Jefr64lK/by/da0ViFcuA4DH0vQg5Q6Ze5VimxkfQNSC+Mls/Kx53s7TjP1RhFEDQ==",
      "engines": {
        "node": "*"
      }
    }
  },
  "dependencies": {
    "lodash": {
      "version": "4.17.21",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz",
      "integrity": "sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg=="
    },
    "moment": {
      "version": "2.29.1",
      "resolved": "https://registry.npmjs.org/moment/-/moment-2.29.1.tgz",
      "integrity": "sha512-kHmoybcPV8Sqy59DwNDY3Jefr64lK/by/da0ViFcuA4DH0vQg5Q6Ze5VimxkfQNSC+Mls/Kx53s7TjP1RhFEDQ=="
    }
  }
}

```

### 安装指定版本的包

默认情况下,使用 npm install t命令安装包的时候,会自动安装最新版本的包。如果需要安装指定版本的包,可以在包名之后,通过@符号指定具体的版本,例如

```javascript
npm
i
moment
@2.22
.2
```

包的语义化版本规范

包的版本号是以“点分十进制”形式进行定义的,总共有三位数字,例如2.24.0

其中每位数字所代表的的含义如下

1. 第1位数字:大版本
2. 第二位数字:功能版本
3. 第三位数字:bug修复版本

版本号提升的规则:只要前面的版本号增长了,则后面的版本号归零

### 包管理配置文件

npm规定,在项目根目录中,必须提供一个叫做 package. json的包管理配置文件。用来记录与项目有关的一些配置信息。例如

- 项目的名称、版本号、描述等
- 项目中都用到了哪些包
- 哪些包只在开发期间会用到那些包
- 在开发和部署时都需要用到

#### 多人协作的问题

![image-20220113232531491](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220113232531491.png)

#### 如何记录项目中安装了哪些包

在项目根目录中,创建一个叫做 package json的配置文件,即可用来记录项目中安装了哪些包。从而方便剔除node modules目录之后,在团队成员之间共亨项目的源代码。

注意:今后在项目开发中,一定要把 node _modules文件夹,添加到 .gitignore忽略文件中。

##### 快速创建 package. json

npm包管理工具提供了一个快捷命令,可以在执行命令时所处的目录中,快速创建 package. json这个包管理配置文件

```
npm init -y
```

- 上述命令只能在英文的目录下成功运行!所以,项目文件夹的名称一定要使用英文命名,不要使用中文,不能出现空格。
- 运行 npm instal命令安装包的时候,npm包管理工具会自动把包的名称和版本号,记录到 package. json中。

![image-20220113233259614](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220113233259614.png)

###### dependencies节点

package json文件中,有一个 dependencies节点,专门用来记录您使用 npm install命令安装了哪些包

## 一次性安装所有的包

当我们拿到一个剔除了 node modules的项目之后,需要先把所有的包下载到项目中,才能将项目运行起来否则会报类似于下面的错误:

```
可以运行 npm install命令(或npm i)一次性安装所有的依赖包
```

## 卸载包

可以运行 npm uninstall命令,来卸载指定的包:

```
npm uninstall moment
```

## devDependencies节点

如果某些包只在项目开发阶段会用到,在项目上线之后不会用到,则建议把这些包记录到 devdependencies节点中与之对应的,如果某些包在开发和项目上线之后都需要用到,则建议把这些包记录到 dependencies节点中。

您可以使用如下的命令,将包记录到 dev Dependencies节点中

```
npm i 包名 -D//简写
```

```
npm install 包名 --save-dev//完整写法
```

## 解决下包速度慢的问题

在使用npm下包的时候,默认从国外的https://registry.npmjs.org/服务器进行下载,此时,网络数据的传输需要经过漫长的海底光缆,因此下包速度会很慢。

### 解决方法1

- 淘宝NPM镜像服务器

  ![image-20220114092059948](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220114092059948.png)

获取npm下包镜像源

```
npm config get registry
```

切换npm淘宝镜像下包地址

```
npm config set registry=https://registry.npm.taobao.org/
```

### 解决办法2

##### nrm

为了更方便的切换下包的镜像源,我们可以安装nrm这个小工具,利用nrm提供的终端命令,可以快速查看和切换下包的镜像源。

安装全局工具

```
npm i nrm -g
```

查看所有镜像源

```
nrm ls
```

切换到淘宝

```
nrm use taobao
```

## 包的分类

### 项目包

1. 那些被安装到项目的 node modules目录中的包,都是项目包
2. 项目包又分为两类,分别是
    1. 开发依赖包(被记录到 devDependencies节点中的包,只在开发期间会用到
    2. 核心依赖包(被记录到 dependencies节点中的包,在开发期间和项目上线之后都会用到)

![image-20220114094445723](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220114094445723.png)

### 全局包

在执行 npm install i命令时,如果提供了-9参数,则会把包安装为全局包。

全局包会被安装到 C: Users\用户目录 ppdata\ Roaming \npm\node modules目录下。

![image-20220114094806688](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220114094806688.png)

注意：只有工具性质的包,才有全局安装的必要性。因为它们提供了好用的终端命令。

### 规范的包结构

在清楚了包的概念、以及如何下载和使用包之后,接下来,我们深入了解一下包的内部结构。

一个规范的包,它的组成结构,必须符合以下3点要求

1. 包必须以单独的目录而存在
2. 包的顶级目录下要必须包含 package. json这个包管理配置文件
3. package. json中必须包含name, version,man这三个勵性,分别代表包的名字、版本号、包的入口

## 开发自己的包

### 需要实现的功能

1. 格式化日期
2. 转义html的特殊字符
3. 还原html的特殊字符

#### 格式化日期

1. index.js
2. package.json
3. REDME.md

index.js

```javascript
function itemS(dateStr) {
    let time = new Date();
    let a = time.getFullYear();
    let b = datE(time.getMonth() + 1);
    let c = datE(time.getDate());
    let aa = datE(time.getHours());
    let bb = datE(time.getMinutes());
    let cc = datE(time.getSeconds());
    return `${a}-${b}-${c}  ${aa}:${bb}:${cc}`
}

function datE(n) {
    return n > 9 ? n : '0' + n
}

module.exports = {
    itemS
}
```

package.js

```javascript
{
    "name"
:
    "itemList",
        "version"
:
    "1.0.0",
        "main"
:
    "index.js",
        "description"
:
    "提供格式化时间",
        "keywords"
:
    [
        "itemList",
        "itemS",
        "escape"
    ],
        "license"
:
    "ISC"
}

```

访问的js

```javascript
const it = require("./itemList");
const as = it.itemS(new Date())
console.log(as)
```

#### 转义html的特殊字符

1. index.js
2. package.json
3. REDME.md

index.js

```javascript
 function HtmlEscape(htmlStar) {
    return htmlStar.replace(/<|>"|%/g, (match) => {
        switch (match) {
            case '<':
                return '&lt';
            case  '>':
                return '&gt';
            case  '"':
                return '&quot';
            case '&':
                return '&amp';
        }
    })
}

module.exports = {
    itemS,
    HtmlEscape
}
```

package.json

```json
{
  "name": "itemList",
  "version": "1.0.0",
  "main": "index.js",
  "description": "转义html",
  "keywords": [
    "itemList",
    "HtmlEscape",
    "escape"
  ],
  "license": "ISC"
}

```

访问的js

```javascript
const it = require("./itemList");
const htm = '<h1 title="abc"><span>123 $nbsp;</span></h1>';
let a = it.HtmlEscape(htm);
console.log(a)
```

结果

**![image-20220114150449216](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220114150449216.png)**

#### 还原html

1. index.js
2. package.json
3. REDME.md

index.js

```javascript
 function htmlClc(str) {
    return str.replace(/&lt;|&gt;|&quot;|&amp;/g, (match) => {
        switch (match) {
            case '&lt;':
                return '<'
            case '&gt;':
                return '>'
            case '&quot;':
                return '"'
            case '&amp;':
                return '&'
        }
    })
}
```

package.json

```json
{
  "name": "itemList",
  "version": "1.0.0",
  "main": "index.js",
  "description": "转义html",
  "keywords": [
    "itemList",
    "htmlClc",
    "escape"
  ],
  "license": "ISC"
}

```

访问

```javascript
const it = require("./itemList");
const as = it.itemS(new Date())
console.log(as)
const htm = '<h1 title="abc"><span>123 $nbsp;</span></h1>';
let a = it.HtmlEscape(htm);
console.log(a)
let b = it.htmlClc(a);
console.log(b)

```

结果

![image-20220114152125950](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220114152125950.png)

#### 模块化拆分

1. 将格式化时间的功能,拆分到src-> dateformat s中
2. 将处理HTML字符串的功能,拆分到src-> htmlescape. js中
3. 在index js中,导入两个模块,得到需要向外共享的方法
4. 在index. js中,使用 module exports把对应的方法共享出去

src

1. htmlClc.js
2. HtmlEscape.js.
3. itemS.js

htmlClc.js

```
function htmlClc(str) {
    return str.replace(/&lt;|&gt;|&quot;|&amp;/g,(match )=> {
        switch (match) {
            case '&lt;':
                return '<'
            case '&gt;':
                return '>'
            case '&quot;':
                return  '"'
            case '&amp;':
                return '&'
        }
    })
}
module.exports={
    htmlClc
}
```

HtmlEscape.js.

```

function HtmlEscape(htmlStar) {
    return htmlStar.replace(/<|>"|%/g,(match )=> {
        switch (match){
            case '<':
                return '&lt;';
            case  '>':
                return '&gt;';
            case  '"':
                return  '&quot;';
            case '&':
                return '&amp;';
        }
    })
}


module.exports={
    HtmlEscape,
}
```

itemS.js

```
function itemS(dateStr) {
    let time=new Date();
    let a=time.getFullYear();
    let b=datE(time.getMonth()+1);
    let c=datE(time.getDate());
    let aa=datE(time.getHours());
    let bb=datE(time.getMinutes());
    let cc=datE(time.getSeconds());
    return `${a}-${b}-${c}  ${aa}:${bb}:${cc}`
}
function datE(n) {
    return  n>9?n:'0'+n
}
module.exports={
    itemS
}
```

index.js

```
let date=require("../src/itemS");
let Html=require("../src/HtmlEscape")
let htmlS=require("../src/htmlClc")
 module.exports={
    ...date,
     ...Html,
     ...htmlS
 }
```

外面访问js

```
const it=require("./itemList");
const as=it.itemS(new Date())
console.log(as)
console.log('----')
const htm='<h1 title="abc"><span>123 $nbsp;</span></h1>';
let a= it.HtmlEscape(htm);
console.log(a)
console.log('----')

let b=it.htmlClc(a);
console.log(b)
console.log('----')

```

![image-20220114154816956](C:\Users\move\AppData\Roaming\Typora\typora-user-images\image-20220114154816956.png)

REDME.md

~~~md
## 安装

```
npm install itemList

```

## 导入

```js
const item=require("itemList")
```

格式化时间

```js
const date=item.itemS(new Date())
console.log(data)
```

## 转义html特殊符号

```js
const htm='<h1 title="abc"><span>123 $nbsp;</span></h1>';
let Html= item.HtmlEscape(htm);
console.log(Html)
```

## 还原html特殊符号

```js
let b=it.htmlClc(a);
console.log(b)
console.log('----')
```

## 开源协议

ISC
~~~

## 发布包

1.前往https://www.npmjs.com/注册用户

2.npm账号注册完成后,可以在终端中执行 npm login命令,依次输入用户名、密码、邮箱后,即可登录成功。

注意:在运行 npm login命令之前,必须先把下包的服务器地址切换为npm的官方服务器。否则会导致发布包失败

```
npm config set registry=https://registry.npmjs.org/
```

3.把包发布到npm上

将终端切换到包的根目录之后,运行 npm publish命令,即可将包发布到npm上(注意:包名不能雷同)。

3.删除已发布的包

运行 npm unpublish包名-orce命令,即可从npm删除已发布的包

1. npm unpublish命令只能删除72小时以内发布的包
2. npm unpublish删除的包,在24小时内不允许重复发布
3. 发布包的时候要慎重,尽量不要往npm上发布没有意义的包